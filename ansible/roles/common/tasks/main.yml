---

- name: Create ~vagrant/.ssh directory
  file: path=/home/vagrant/.ssh state=directory mode=0700 owner=vagrant

- name: Copy SSH private key
  copy: src=id_rsa dest=/home/vagrant/.ssh/id_rsa mode=0600 owner=vagrant

- name: Copy SSH public key
  copy: src=id_rsa.pub dest=/home/vagrant/.ssh/id_rsa.pub mode=0644 owner=vagrant

- name: Copy SSH known_hosts
  copy: src=known_hosts dest=/home/vagrant/.ssh/known_hosts mode=0644 owner=vagrant

- name: Copy SSH tunnel service
  copy: src=sshtunnel.upstart.conf dest=/etc/init/sshtunnel.conf

- name: Reload Upstart configuration
  command: initctl reload-configuration

- name: Start SSH tunnel service
  service: name=sshtunnel state=started

- name: Install apt-cacher-ng apt configuration
  copy: src=99apt-cacher-ng dest=/etc/apt/apt.conf.d/99apt-cacher-ng

- name: Install required packages
  apt: pkg={{item}} state=installed update_cache=yes
  with_items:
    - git
    - wget
    - ntp
    - sudo
    - procps

- name: Stop puppet service
  service: name=puppet state=stopped

- name: Stop chef-client service
  service: name=chef-client state=stopped

- name: Create JDK directory
  file: path=/usr/lib/jvm state=directory

- name: Copy and extract JDK tgz
  unarchive: src=jdk-7u71-linux-x64.tar.gz dest=/usr/lib/jvm creates=/usr/lib/jvm/jdk1.7.0_71

- name: Copy Oracle JDK installation script
  copy: src=install-oracle-jdk.sh dest=/home/vagrant/install-oracle-jdk.sh

- name: Run Oracle JDK installation script
  command: chdir=/home/vagrant bash install-oracle-jdk.sh

- name: Create hadoop directory
  file: path=/home/vagrant/hadoop state=directory

- name: Copy and extract Hadoop tgz
  unarchive: src=hadoop-2.6.0.tar.gz dest=/home/vagrant/hadoop creates=/home/vagrant/hadoop/hadoop-2.6.0

- name: Install hadoop config hadoop-env.sh
  template: src=templates/common/hadoop-config/hadoop-env.sh dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/hadoop-env.sh

- name: Install hadoop config core-site.xml
  template: src=templates/common/hadoop-config/core-site.xml dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/core-site.xml

- name: Install hadoop config hdfs-site.xml
  template: src=templates/common/hadoop-config/hdfs-site.xml dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/hdfs-site.xml

- name: Install hadoop config yarn-env.sh
  template: src=templates/common/hadoop-config/yarn-env.sh dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/yarn-env.sh

- name: Install hadoop config yarn-site.xml
  template: src=templates/common/hadoop-config/yarn-site.xml dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/yarn-site.xml

- name: Install hadoop config mapred-env.sh
  template: src=templates/common/hadoop-config/mapred-env.sh dest=/home/vagrant/hadoop/hadoop-2.6.0/etc/hadoop/mapred-env.sh

- name: Create hadoop data directory
  file: path=/home/vagrant/data state=directory

- name: Create hadoop namenode directory
  file: path=/home/vagrant/data/namenode-name-dir state=directory owner=vagrant

- name: Create hadoop datanode directory
  file: path=/home/vagrant/data/datanode-data-dir state=directory owner=vagrant

